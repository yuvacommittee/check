// Sample Data for November 2025
const november2025Data = {
    summary: {
        totalCardsTxns: 406,
        phhCardsTxns: 372,
        aayCardsTxns: 34,
        phhUnitsSale: 1825,
        commission: "‚Çπ9,283.50",
        totalWheat: "4126.0",
        totalRice: "6189.0"
    },
    transactions: [
        { date: "9 Nov 2025", cards: 4, wheatPHH: 14.0, wheatAAY: 38.0, ricePHH: 21.0, riceAAY: 57.0 },
        { date: "10 Nov 2025", cards: 96, wheatPHH: 168.0, wheatAAY: 816.0, ricePHH: 252.0, riceAAY: 1224.0 },
        { date: "11 Nov 2025", cards: 92, wheatPHH: 168.0, wheatAAY: 788.0, ricePHH: 252.0, riceAAY: 1182.0 },
        { date: "12 Nov 2025", cards: 113, wheatPHH: 70.0, wheatAAY: 1046.0, ricePHH: 105.0, riceAAY: 1569.0 },
        { date: "13 Nov 2025", cards: 45, wheatPHH: 0, wheatAAY: 458.0, ricePHH: 0, riceAAY: 687.0 },
        { date: "14 Nov 2025", cards: 21, wheatPHH: 42.0, wheatAAY: 172.0, ricePHH: 63.0, riceAAY: 258.0 },
        { date: "15 Nov 2025", cards: 10, wheatPHH: 14.0, wheatAAY: 100.0, ricePHH: 21.0, riceAAY: 150.0 },
        { date: "16 Nov 2025", cards: 12, wheatPHH: 0, wheatAAY: 110.0, ricePHH: 0, riceAAY: 165.0 },
        { date: "17 Nov 2025", cards: 4, wheatPHH: 0, wheatAAY: 42.0, ricePHH: 0, riceAAY: 63.0 },
        { date: "18 Nov 2025", cards: 5, wheatPHH: 0, wheatAAY: 44.0, ricePHH: 0, riceAAY: 66.0 },
        { date: "19 Nov 2025", cards: 1, wheatPHH: 0, wheatAAY: 8.0, ricePHH: 0, riceAAY: 12.0 },
        { date: "22 Nov 2025", cards: 2, wheatPHH: 0, wheatAAY: 20.0, ricePHH: 0, riceAAY: 30.0 },
        { date: "25 Nov 2025", cards: 1, wheatPHH: 0, wheatAAY: 8.0, ricePHH: 0, riceAAY: 12.0 }
    ],
    totals: {
        cards: 406,
        wheatPHH: 476.0,
        wheatAAY: 3650.0,
        ricePHH: 714.0,
        riceAAY: 5475.0
    }
};

// Sample Data for December 2025 (‡§Ü‡§™‡§®‡•á ‡§ú‡•ã screenshot ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§π‡•à)
const december2025Data = {
    summary: {
        totalCardsTxns: 450,
        phhCardsTxns: 410,
        aayCardsTxns: 40,
        phhUnitsSale: 2000,
        commission: "‚Çπ10,500.00",
        totalWheat: "4500.0",
        totalRice: "6750.0"
    },
    transactions: [
        { date: "1 Dec 2025", cards: 20, wheatPHH: 50.0, wheatAAY: 150.0, ricePHH: 75.0, riceAAY: 225.0 },
        { date: "2 Dec 2025", cards: 35, wheatPHH: 80.0, wheatAAY: 250.0, ricePHH: 120.0, riceAAY: 375.0 },
        { date: "3 Dec 2025", cards: 28, wheatPHH: 65.0, wheatAAY: 195.0, ricePHH: 97.5, riceAAY: 292.5 },
        { date: "4 Dec 2025", cards: 42, wheatPHH: 95.0, wheatAAY: 285.0, ricePHH: 142.5, riceAAY: 427.5 },
        { date: "5 Dec 2025", cards: 55, wheatPHH: 120.0, wheatAAY: 360.0, ricePHH: 180.0, riceAAY: 540.0 },
        { date: "6 Dec 2025", cards: 30, wheatPHH: 70.0, wheatAAY: 210.0, ricePHH: 105.0, riceAAY: 315.0 },
        { date: "7 Dec 2025", cards: 25, wheatPHH: 60.0, wheatAAY: 180.0, ricePHH: 90.0, riceAAY: 270.0 },
        { date: "8 Dec 2025", cards: 40, wheatPHH: 90.0, wheatAAY: 270.0, ricePHH: 135.0, riceAAY: 405.0 },
        { date: "9 Dec 2025", cards: 33, wheatPHH: 75.0, wheatAAY: 225.0, ricePHH: 112.5, riceAAY: 337.5 },
        { date: "10 Dec 2025", cards: 47, wheatPHH: 105.0, wheatAAY: 315.0, ricePHH: 157.5, riceAAY: 472.5 },
        { date: "11 Dec 2025", cards: 22, wheatPHH: 55.0, wheatAAY: 165.0, ricePHH: 82.5, riceAAY: 247.5 },
        { date: "12 Dec 2025", cards: 38, wheatPHH: 85.0, wheatAAY: 255.0, ricePHH: 127.5, riceAAY: 382.5 }
    ],
    totals: {
        cards: 415,
        wheatPHH: 950.0,
        wheatAAY: 2850.0,
        ricePHH: 1425.0,
        riceAAY: 4275.0
    }
};

// Sample Data for October 2025
const october2025Data = {
    summary: {
        totalCardsTxns: 380,
        phhCardsTxns: 350,
        aayCardsTxns: 30,
        phhUnitsSale: 1700,
        commission: "‚Çπ8,500.00",
        totalWheat: "3800.0",
        totalRice: "5700.0"
    },
    transactions: [
        { date: "5 Oct 2025", cards: 15, wheatPHH: 35.0, wheatAAY: 105.0, ricePHH: 52.5, riceAAY: 157.5 },
        { date: "6 Oct 2025", cards: 28, wheatPHH: 65.0, wheatAAY: 195.0, ricePHH: 97.5, riceAAY: 292.5 },
        { date: "7 Oct 2025", cards: 32, wheatPHH: 75.0, wheatAAY: 225.0, ricePHH: 112.5, riceAAY: 337.5 },
        { date: "8 Oct 2025", cards: 45, wheatPHH: 100.0, wheatAAY: 300.0, ricePHH: 150.0, riceAAY: 450.0 },
        { date: "9 Oct 2025", cards: 22, wheatPHH: 55.0, wheatAAY: 165.0, ricePHH: 82.5, riceAAY: 247.5 },
        { date: "10 Oct 2025", cards: 38, wheatPHH: 85.0, wheatAAY: 255.0, ricePHH: 127.5, riceAAY: 382.5 },
        { date: "11 Oct 2025", cards: 41, wheatPHH: 95.0, wheatAAY: 285.0, ricePHH: 142.5, riceAAY: 427.5 },
        { date: "12 Oct 2025", cards: 27, wheatPHH: 65.0, wheatAAY: 195.0, ricePHH: 97.5, riceAAY: 292.5 },
        { date: "13 Oct 2025", cards: 35, wheatPHH: 80.0, wheatAAY: 240.0, ricePHH: 120.0, riceAAY: 360.0 },
        { date: "14 Oct 2025", cards: 29, wheatPHH: 70.0, wheatAAY: 210.0, ricePHH: 105.0, riceAAY: 315.0 },
        { date: "15 Oct 2025", cards: 33, wheatPHH: 75.0, wheatAAY: 225.0, ricePHH: 112.5, riceAAY: 337.5 }
    ],
    totals: {
        cards: 345,
        wheatPHH: 800.0,
        wheatAAY: 2400.0,
        ricePHH: 1200.0,
        riceAAY: 3600.0
    }
};

// Monthly data mapping
const monthlyData = {
    '2025-10': october2025Data,
    '2025-11': november2025Data,
    '2025-12': december2025Data
};

// ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞
document.addEventListener('DOMContentLoaded', function() {
    // ‡§ï‡§∞‡§Ç‡§ü ‡§°‡•á‡§ü ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
    updateCurrentDateTime();
    
    // Fetch Report ‡§¨‡§ü‡§®
    document.getElementById('fetchBtn').addEventListener('click', fetchReport);
    
    // Copy ‡§¨‡§ü‡§®
    document.getElementById('copyBtn').addEventListener('click', copyData);
    
    // PDF ‡§¨‡§ü‡§®
    document.getElementById('pdfBtn').addEventListener('click', saveAsPDF);
    
    // ‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§°‡•á‡§ü‡§æ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
    showDefaultData();
});

// ‡§ï‡§∞‡§Ç‡§ü ‡§°‡•á‡§ü ‡§ü‡§æ‡§á‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
function updateCurrentDateTime() {
    const now = new Date();
    const dateStr = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}, ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
    document.getElementById('currentDate').textContent = dateStr;
    
    // ‡§π‡§∞ ‡§Æ‡§ø‡§®‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã
    setTimeout(updateCurrentDateTime, 60000);
}

// ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§°‡•á‡§ü‡§æ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
function showDefaultData() {
    const month = document.getElementById('month').value;
    const year = document.getElementById('year').value;
    const key = `${year}-${month}`;
    
    // ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (November 2025)
    if (monthlyData[key]) {
        loadReportData(monthlyData[key]);
    } else {
        loadReportData(november2025Data);
    }
}

// Report Fetch ‡§ï‡§∞‡•á‡§Ç
function fetchReport() {
    const fetchBtn = document.getElementById('fetchBtn');
    const loadingDiv = document.getElementById('loading');
    
    // Loading ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
    fetchBtn.innerHTML = '‚è≥ Loading...';
    fetchBtn.disabled = true;
    loadingDiv.style.display = 'block';
    
    // Shop ID, Month, Year ‡§≤‡•á‡§Ç
    const shopId = document.getElementById('shopId').value;
    const month = document.getElementById('month').value;
    const year = document.getElementById('year').value;
    
    // Shop ID validation
    if (!shopId || shopId.trim() === '') {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ Shop ID ‡§°‡§æ‡§≤‡•á‡§Ç!');
        resetButton(fetchBtn);
        loadingDiv.style.display = 'none';
        return;
    }
    
    // Real API call ‡§ï‡§æ simulation
    simulateAPICall(shopId, month, year, fetchBtn, loadingDiv);
}

// API call simulate ‡§ï‡§∞‡•á‡§Ç
function simulateAPICall(shopId, month, year, fetchBtn, loadingDiv) {
    // API endpoint (‡§Ü‡§™‡§ï‡§æ Vercel app)
    const apiUrl = 'https://rps-eta-orpin.vercel.app/';
    
    // Key for mock data
    const key = `${year}-${month}`;
    
    // 2 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (API ‡§∏‡§ø‡§Æ‡•ç‡§Ø‡•Å‡§≤‡•á‡§∂‡§®)
    setTimeout(() => {
        // Check if we have mock data for this month
        if (monthlyData[key]) {
            loadReportData(monthlyData[key]);
            fetchBtn.innerHTML = '‚úÖ Report Loaded';
        } else {
            // If no data for selected month, show November data
            loadReportData(november2025Data);
            fetchBtn.innerHTML = '‚ö†Ô∏è Using Sample Data';
        }
        
        fetchBtn.disabled = false;
        loadingDiv.style.display = 'none';
        
        // Shop ID ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç summary ‡§Æ‡•á‡§Ç
        document.getElementById('shopIdDisplay').textContent = `Shop ID: ${shopId}`;
        
        // 3 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ ‡§¨‡§ü‡§® ‡§∞‡§ø‡§∏‡•á‡§ü
        setTimeout(() => {
            fetchBtn.innerHTML = 'üì• Fetch Report';
        }, 3000);
    }, 2000);
}

// ‡§¨‡§ü‡§® ‡§∞‡§ø‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
function resetButton(button) {
    button.innerHTML = 'üì• Fetch Report';
    button.disabled = false;
}

// ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
function loadReportData(data) {
    // Summary ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    document.getElementById('totalCards').textContent = data.summary.totalCardsTxns;
    document.getElementById('totalWheat').textContent = data.summary.totalWheat + ' Kg';
    document.getElementById('totalRice').textContent = data.summary.totalRice + ' Kg';
    document.getElementById('commission').textContent = data.summary.commission;
    
    // Summary ‡§î‡§∞ Action ‡§¨‡§ü‡§® ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
    document.getElementById('summarySection').style.display = 'grid';
    document.getElementById('actionButtons').style.display = 'flex';
    
    // ‡§ü‡•á‡§¨‡§≤ ‡§¨‡•â‡§°‡•Ä
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    
    // ‡§°‡•á‡§ü‡§æ ‡§∞‡•ã‡§ú‡§º ‡§è‡§° ‡§ï‡§∞‡•á‡§Ç
    data.transactions.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.date}</td>
            <td>${item.cards}</td>
            <td>${item.wheatPHH || item.wheatPHH === 0 ? item.wheatPHH : '-'}</td>
            <td>${item.wheatAAY || item.wheatAAY === 0 ? item.wheatAAY : '-'}</td>
            <td>${item.ricePHH || item.ricePHH === 0 ? item.ricePHH : '-'}</td>
            <td>${item.riceAAY || item.riceAAY === 0 ? item.riceAAY : '-'}</td>
        `;
        tbody.appendChild(row);
    });
    
    // ‡§ü‡•ã‡§ü‡§≤ ‡§∞‡•ã ‡§è‡§° ‡§ï‡§∞‡•á‡§Ç
    const tfoot = document.getElementById('tableFooter');
    tfoot.innerHTML = `
        <tr style="background: #f8f9fa; font-weight: bold;">
            <td>TOTAL</td>
            <td>${data.totals.cards}</td>
            <td>${data.totals.wheatPHH}</td>
            <td>${data.totals.wheatAAY}</td>
            <td>${data.totals.ricePHH}</td>
            <td>${data.totals.riceAAY}</td>
        </tr>
    `;
    tfoot.style.display = 'table-footer-group';
}

// ‡§°‡•á‡§ü‡§æ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç
function copyData() {
    const shopId = document.getElementById('shopId').value;
    const monthSelect = document.getElementById('month');
    const monthName = monthSelect.options[monthSelect.selectedIndex].text;
    const year = document.getElementById('year').value;
    
    let text = "UPPDS Visiontek Report\n";
    text += "=======================\n\n";
    text += `Shop ID: ${shopId}\n`;
    text += `Month: ${monthName} ${year}\n`;
    text += `Report Generated: ${document.getElementById('currentDate').textContent}\n\n`;
    
    // Summary
    const totalCards = document.getElementById('totalCards').textContent;
    const totalWheat = document.getElementById('totalWheat').textContent;
    const totalRice = document.getElementById('totalRice').textContent;
    const commission = document.getElementById('commission').textContent;
    
    text += `Total Cards Transactions: ${totalCards}\n`;
    text += `Total Wheat: ${totalWheat}\n`;
    text += `Total Rice: ${totalRice}\n`;
    text += `Commission: ${commission}\n\n`;
    
    // Headers
    text += "Date\tCards\tWheat PHH\tWheat AAY\tRice PHH\tRice AAY\n";
    
    // Data from table
    const rows = document.querySelectorAll('#tableBody tr');
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length === 6) {
            text += `${cells[0].textContent}\t${cells[1].textContent}\t${cells[2].textContent}\t${cells[3].textContent}\t${cells[4].textContent}\t${cells[5].textContent}\n`;
        }
    });
    
    // Total row
    const totalRow = document.querySelector('#tableFooter tr');
    if (totalRow) {
        const totalCells = totalRow.querySelectorAll('td');
        if (totalCells.length === 6) {
            text += `\n${totalCells[0].textContent}\t${totalCells[1].textContent}\t${totalCells[2].textContent}\t${totalCells[3].textContent}\t${totalCells[4].textContent}\t${totalCells[5].textContent}\n`;
        }
    }
    
    // Copy to clipboard
    navigator.clipboard.writeText(text).then(() => {
        alert('Report copied to clipboard! üìã');
    }).catch(err => {
        console.error('Copy failed: ', err);
        alert('Copy failed. Please select the text manually.');
    });
}

// PDF ‡§¨‡§®‡§æ‡§è‡§Ç
function saveAsPDF() {
    const shopId = document.getElementById('shopId').value;
    const monthSelect = document.getElementById('month');
    const monthName = monthSelect.options[monthSelect.selectedIndex].text;
    const year = document.getElementById('year').value;
    
    // Create a simple HTML content for PDF
    const content = `
        <html>
        <head>
            <title>UPPDS Visiontek Report - ${shopId}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                h1 { color: #2c3e50; }
                h2 { color: #34495e; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f2f2f2; }
                .summary { background-color: #e8f4f8; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
                .footer { margin-top: 30px; font-size: 12px; color: #7f8c8d; }
            </style>
        </head>
        <body>
            <h1>UPPDS Visiontek Report</h1>
            <p><strong>Shop ID:</strong> ${shopId}</p>
            <p><strong>Month:</strong> ${monthName} ${year}</p>
            <p><strong>Report Generated:</strong> ${document.getElementById('currentDate').textContent}</p>
            
            <div class="summary">
                <h2>Summary</h2>
                <p><strong>Total Cards Transactions:</strong> ${document.getElementById('totalCards').textContent}</p>
                <p><strong>Total Wheat:</strong> ${document.getElementById('totalWheat').textContent}</p>
                <p><strong>Total Rice:</strong> ${document.getElementById('totalRice').textContent}</p>
                <p><strong>Commission:</strong> ${document.getElementById('commission').textContent}</p>
            </div>
            
            <h2>Daily Transaction Report</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Cards</th>
                        <th>Wheat PHH</th>
                        <th>Wheat AAY</th>
                        <th>Rice PHH</th>
                        <th>Rice AAY</th>
                    </tr>
                </thead>
                <tbody>
                    ${document.getElementById('tableBody').innerHTML}
                </tbody>
                <tfoot>
                    ${document.getElementById('tableFooter').innerHTML}
                </tfoot>
            </table>
            
            <div class="footer">
                <p>Website: https://mispds.blogspot.com/</p>
                <p>This report is generated by UPPDS Visiontek System</p>
            </div>
        </body>
        </html>
    `;
    
    // Open print dialog for PDF
    const printWindow = window.open('', '_blank');
    printWindow.document.write(content);
    printWindow.document.close();
    
    // Wait for content to load
    setTimeout(() => {
        printWindow.print();
        printWindow.close();
    }, 500);
        }
